{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","Account","register","username","body","email","password","err","account","send","passport","authenticate","session","status","scope","generateAccessToken","respond","get","logout","json","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAEe,gBAAkB;AAAA,QAAhBA,MAAgB,QAAhBA,MAAgB;AAAA,QAARC,EAAQ,QAARA,EAAQ;;AAC7B,QAAIC,MAAM,sBAAV;;AAEA;;AAEA;AACAA,QAAIC,IAAJ,CAAS,WAAT,EAAqB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC/BC,0BAAQC,QAAR,CAAiB,IAAID,iBAAJ,CAAY,EAACE,UAAUJ,IAAIK,IAAJ,CAASC,KAApB,EAAZ,CAAjB,EAAyDN,IAAIK,IAAJ,CAASE,QAAlE,EAA4E,UAASC,GAAT,EAAcC,OAAd,EAAsB;AAC/F,gBAAGD,GAAH,EAAO;AACHP,oBAAIS,IAAJ,CAASF,GAAT;AACH;AACDG,+BAASC,YAAT,CACI,OADJ,EACY;AACJC,yBAAS;AADL,aADZ,EAIEb,GAJF,EAIMC,GAJN,EAIW,YAAK;AACZA,oBAAIa,MAAJ,CAAW,GAAX,EAAgBJ,IAAhB,CAAqB,mCAArB;AACH,aAND;AAOF,SAXD;AAYH,KAbD;;AAeA;AACAZ,QAAIC,IAAJ,CAAS,QAAT,EAAkBY,mBAASC,YAAT,CACd,OADc,EACL;AACLC,iBAAS,KADJ;AAELE,eAAO;AAFF,KADK,CAAlB,EAKIC,mCALJ,EAKyBC,uBALzB;;AAQA;AACAnB,QAAIoB,GAAJ,CAAQ,SAAR,EAAkBN,4BAAlB,EAAgC,UAACZ,GAAD,EAAKC,GAAL,EAAa;AAC1CA,YAAIkB,MAAJ;AACAlB,YAAIa,MAAJ,CAAW,GAAX,EAAgBJ,IAAhB,CAAqB,0BAArB;AACF,KAHD;;AAKA;AACAZ,QAAIoB,GAAJ,CAAQ,KAAR,EAAcN,4BAAd,EAA4B,UAACZ,GAAD,EAAKC,GAAL,EAAa;AACrCA,YAAIa,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqBnB,IAAIoB,IAAzB;AACH,KAFD;;AAKA,WAAOvB,GAAP;AACH,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport Account from '../model/account';\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\nimport config from '../config';\n\nimport { generateAccessToken, respond, authenticate } from '../middleware/authMiddleware';\n\nexport default ({config, db}) => {\n    let api = Router();\n    \n    // routes here start with v1/account/\n    \n    // POST /v1/account/register\n    api.post('/register',(req, res) => {\n        Account.register(new Account({username: req.body.email}),req.body.password, function(err, account){\n           if(err){\n               res.send(err);\n           } \n           passport.authenticate(\n               'local',{\n                   session: false\n               }\n           )(req,res, () =>{\n               res.status(200).send('Successfully created new account.');\n           })\n        });\n    });\n    \n    // POST /v1/account/login\n    api.post('/login',passport.authenticate(\n        'local', {\n            session: false,\n            scope: []\n        }),\n        generateAccessToken, respond\n    );\n    \n    // GET /v1/account/logout\n    api.get('/logout',authenticate, (req,res) => {\n       res.logout();\n       res.status(200).send('Successfully logged out.');\n    });\n    \n    // GET /v1/account/me\n    api.get('/me',authenticate, (req,res) => {\n        res.status(200).json(res.user);\n    });\n    \n    \n    return api;\n}"]}